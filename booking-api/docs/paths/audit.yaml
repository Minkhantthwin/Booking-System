tags:
  - name: Audit
    description: Audit log operations (admin only)

paths:
  /audit:
    post:
      tags: [Audit]
      summary: Create audit log
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditLogCreateRequest'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  log:
                    $ref: '#/components/schemas/AuditLog'
        '400': { description: Validation error }
        '500': { description: Internal server error }
    get:
      tags: [Audit]
      summary: List audit logs
      description: Supports pagination and filtering.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 200, default: 25 }
        - in: query
          name: user_id
          schema: { type: integer }
        - in: query
          name: action
          schema: { type: string }
        - in: query
          name: entity
          schema: { type: string }
        - in: query
          name: entity_id
          schema: { type: integer }
        - in: query
          name: from
          schema: { type: string, format: date-time }
        - in: query
          name: to
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogList'
        '400': { description: Validation error }
        '500': { description: Internal server error }

  /audit/stats/actions:
    get:
      tags: [Audit]
      summary: Audit log action counts
      description: Returns counts grouped by action for optional date range.
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: from
          schema: { type: string, format: date-time }
        - in: query
          name: to
          schema: { type: string, format: date-time }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogStats'
        '400': { description: Validation error }
        '500': { description: Internal server error }

  /audit/{id}:
    get:
      tags: [Audit]
      summary: Get audit log by ID
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  log:
                    $ref: '#/components/schemas/AuditLog'
        '400': { description: Validation error }
        '404': { description: Not found }
        '500': { description: Internal server error }
    put:
      tags: [Audit]
      summary: Update audit log
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditLogUpdateRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  log:
                    $ref: '#/components/schemas/AuditLog'
        '400': { description: Validation error }
        '404': { description: Not found }
        '500': { description: Internal server error }
    delete:
      tags: [Audit]
      summary: Delete audit log
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '204': { description: Deleted }
        '400': { description: Validation error }
        '404': { description: Not found }
        '500': { description: Internal server error }